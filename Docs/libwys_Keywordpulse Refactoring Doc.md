# 🧹 리팩토링 전략 문서 (KeywordPulse)

이 문서는 KeywordPulse 프로젝트의 핵심 모듈, API, UI 컴포넌트 등에 대한 구조적 리팩토링 전략과 기준을 정의합니다. 기술 부채 최소화, 유지보수 효율성 향상, 기능 확장성을 고려한 설계 원칙을 포함합니다.

---

## 🎯 리팩토링 목표

| 목적 | 설명 |
|------|------|
| 코드 가독성 향상 | 중복 제거, 명확한 네이밍, 함수 분리 등 |
| 기능별 책임 분리 | 단일 책임 원칙(SRP)에 맞춘 구조 재정렬 |
| 공통 유틸리티화 | 반복되는 로직을 모듈화 및 재사용 가능하게 구성 |
| 테스트 가능성 확보 | 유닛/통합 테스트 작성이 가능한 구조로 분할 |

---

## 📦 주요 리팩토링 대상 영역

### 🔧 1. Python API 함수 / TypeScript API

| 대상 파일 | 개선 항목 | 상태 |
|------------|-----------|------|
| `search.py` | 크롤링/점수화/정규화 로직 분리 → `utils/search_utils.py`로 모듈화 | ✅ 완료 |
| `analyze.py` | 템플릿 생성기 → `rag_engine.py`로 분리 | ✅ 완료 |
| `app/api/analyze/route.ts` | 분석 함수를 `lib/rag_engine.ts`로 모듈화 | ✅ 완료 |
| `sync.py` | Google Sheets 연결/인증 로직을 별도 `google_client.py`로 추출 | ✅ 완료 |
| `notify.py` | Telegram 전송기 모듈화 + 예외 핸들러 분리 적용 | ✅ 완료 |

### 🧠 2. RAG 시스템
- 템플릿 엔진 / 데이터 전처리 / 토큰 필터링을 각각 함수화 ✅
- RAG 관련 함수는 `rag_engine.ts` 내 전담 관리 ✅
- 카테고리별 템플릿 생성 함수 분리 ✅
- 로깅 및 오류 처리 기능 통합 ✅
- 향후 GPT 통합 시에도 동일 인터페이스 유지 (`generateKeywordAnalysis(keywords: string[])` 형태)

### 🧱 3. 프론트엔드 (Next.js) 컴포넌트

| 컴포넌트 | 개선 방향 | 상태 |
|-----------|------------|------|
| `KeywordTable` | 정렬 기능 분리 → `useKeywordSorting` 훅 생성 | ✅ 완료 |
| | 배지 표시 기능 → `useKeywordScoreBadge` 훅 개선 | ✅ 완료 |
| `AnalysisCard` | 문서 접기/펼치기 기능 추가 | ✅ 완료 |
| | 복사 기능 UX 개선 및 복사 확인 시각화 | ✅ 완료 |
| `AnalysisRenderer` | 마크다운 렌더링 스타일 개선 및 접근성 속성 추가 | ✅ 완료 |
| `ActionButtons` | 상태 관리 로직 개선 | ✅ 완료 |

### 🏗️ 4. 프로젝트 구조 및 경로 체계

| 항목 | 개선 사항 | 상태 |
|------|-----------|------|
| 경로 별칭 설정 | tsconfig.json에 paths 설정 (`@/*` → `./app/*`) | ✅ 완료 |
| 레이아웃 구조 | app/privacy, app/terms에 레이아웃 추가 | ✅ 완료 |
| 캐시 관리 | 빌드 캐시 클리어 및 안정화 | ✅ 완료 |
| 삭제된 파일 참조 | 삭제된 훅 파일 참조 해결 | ✅ 완료 |
| 경로 일관성 | 모든 import 경로를 절대 경로(@/)로 표준화 | ✅ 완료 |
| 훅 구조 개선 | 훅을 루트 hooks 디렉토리로 복사 | ✅ 완료 |
| 자동화 도구 | 경로 참조 검증 스크립트 개발 | 🔜 예정 |

### 🧰 5. 새롭게 추가된 유틸리티

| 유틸리티 | 설명 | 상태 |
|-----------|------|------|
| `useKeywordSorting` | 제네릭 타입 지원 정렬 기능 훅 | ✅ 완료 |
| `useKeywordScoreBadge` | 키워드 점수별 배지 생성 훅 (접근성, 색상 개선) | ✅ 완료 |
| `useClipboard` | 클립보드 복사 기능 통합 훅 | ✅ 완료 |

---

## 🔁 코드 리팩토링 규칙 (2023.5.12 업데이트)

| 항목 | 기준 |
|------|------|
| 함수 길이 | 한 함수는 50줄 이하 유지 권장 |
| 변수명 | 의미 있는 한글/영문명 혼용 금지 → snake_case 통일 (Python), camelCase (TypeScript) |
| 예외 처리 | 모든 외부 호출 시 `try/catch` 블록 적용 + 상세 에러 메시지 작성 |
| 타입 명시 | Pydantic 모델 및 TypeScript에서 명시적으로 type/interface 선언 적용 |
| 컴포넌트 분리 | 컴포넌트 내 중첩/조건부 렌더링 복잡도가 높은 경우 별도 컴포넌트로 분리 |
| 재사용성 | 2곳 이상에서 사용되는 로직은 훅 또는 유틸리티 함수로 분리 |
| 접근성 | 모든 UI 컴포넌트는 적절한 aria 속성과 키보드 접근성 제공 |

---

## 🔄 리팩토링 성과 (2023.5.26 추가)

### ✅ 완료된 리팩토링

1. **코드 모듈화 개선**
   - RAG 분석 로직을 `rag_engine.ts`로 분리하여 관심사 분리
   - 카테고리별 분석 함수를 독립적으로 구현하여 확장성 확보
   - UI 컴포넌트에서 핵심 로직을 훅으로 분리
   - 메모이제이션 기법을 적용하여 성능 최적화 구현

2. **UI 컴포넌트 개선**
   - 키워드 추천 배지 색상 및 접근성 강화
   - AnalysisCard에 접기/펼치기 기능 추가로 사용성 향상
   - 복사 상태 시각적 피드백 개선
   - ActionButtons 상태 관리 로직 개선으로 코드 명확성 확보
   - 모든 UI 컴포넌트의 접근성 속성(aria-label 등) 추가

3. **성능 최적화**
   - 정렬 로직에 useMemo 적용으로 불필요한 재계산 방지
   - 컴포넌트 props 타입 명시로 타입 안정성 확보
   - RAG 시스템 내 캐싱 메커니즘 적용으로 성능 향상
   - 트렌드 API 응답에 메모이제이션 적용으로 중복 요청 제거

4. **개발자 경험 개선**
   - 코드 주석 및 JSDoc 추가로 문서화 개선
   - 함수 및 훅의 재사용성 향상으로 개발 효율성 증가
   - 일관된 에러 처리 패턴 적용으로 디버깅 용이성 증가
   - 모든 유틸리티 함수에 단위 테스트 추가

5. **프로젝트 구조 개선**
   - Next.js 프로젝트 구조 문제 해결 및 표준화
   - 경로 별칭 설정을 통한 import 경로 일관성 확보
   - 루트 레이아웃 문제 해결로 빌드 안정성 확보
   - 훅 파일 위치 통일 및 상대 경로에서 절대 경로로 변경
   - 컴포넌트 import 경로 표준화로 Vercel 배포 문제 해결

6. **코드 품질 향상**
   - 중복 로직 제거 및 함수 추출로 코드 재사용성 향상
   - 컴포넌트 책임 분리를 통한 유지보수 용이성 증가
   - TypeScript 타입 정의 개선 및 interface 체계화
   - 모든 외부 API 호출에 적절한 에러 처리 추가

---

## 📎 참고 문서
- [RAG 문서] → 템플릿 기반 함수 분리 기준
- [WBS 일정표] → 리팩토링 할당 일정 연동
- [Cursor Rules] → 코드 리팩토링 시 강제 적용되는 개발 기준
- [테스트 전략] → 테스트 가능 구조로 변경된 함수 구조 활용

---

## 📊 다음 단계 (2023.5.26 업데이트)

1. **컴포넌트 간 상태 관리 개선**
   - 컴포넌트 간 상태 공유 최적화
   - Context API 활용 또는 상태 관리 라이브러리 도입 검토
   - 컴포넌트 계층 구조 재정립

2. **TypeScript 타입 정의 심화**
   - 공통 타입 정의 파일 생성 및 표준화
   - 유니온 타입 및 제네릭 타입 활용 확대
   - TypeScript 강력한 타입 확인을 위한 tsconfig 설정 최적화

3. **경로 관리 자동화**
   - 빌드 전 경로 참조 검증 스크립트 개발
   - 자동 경로 수정 도구 구현
   - 경로 문제 자동 감지 및 수정 기능 추가

4. **테스트 코드 확장**
   - 유틸리티 함수 단위 테스트 확대
   - 컴포넌트 스냅샷 테스트 도입
   - 통합 테스트 범위 확대
   - 테스트 커버리지 목표 80% 이상 설정

5. **코드 스플리팅 및 지연 로딩**
   - 대형 컴포넌트 코드 스플리팅 구현
   - 번들 크기 최적화를 위한 지연 로딩 적용
   - 성능 메트릭 기반 최적화 전략 수립

6. **모바일 최적화**
   - 모바일 환경에서의 렌더링 성능 최적화
   - 모바일 특화 UI/UX 개선
   - 터치 이벤트 및 제스처 최적화

7. **폴더 구조 재검토**
   - 기능별 모듈화 및 디렉토리 구조 개선
   - 관련 컴포넌트 그룹화 및 구조화
   - 일관된 파일 명명 규칙 적용

이러한 리팩토링 작업은 5월 27일부터 6월 10일까지 단계적으로 진행될 예정이며, 우선순위에 따라 일정이 조정될 수 있습니다. 모든 리팩토링 작업은 코드 품질 향상, 유지보수성 개선, 개발자 경험 향상을 목표로 합니다.

마지막 업데이트: 2023.05.26