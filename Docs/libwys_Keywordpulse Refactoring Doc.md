# 🧹 리팩토링 전략 문서 (KeywordPulse)

이 문서는 KeywordPulse 프로젝트의 핵심 모듈, API, UI 컴포넌트 등에 대한 구조적 리팩토링 전략과 기준을 정의합니다. 기술 부채 최소화, 유지보수 효율성 향상, 기능 확장성을 고려한 설계 원칙을 포함합니다.

---

## 🎯 리팩토링 목표

| 목적 | 설명 |
|------|------|
| 코드 가독성 향상 | 중복 제거, 명확한 네이밍, 함수 분리 등 |
| 기능별 책임 분리 | 단일 책임 원칙(SRP)에 맞춘 구조 재정렬 |
| 공통 유틸리티화 | 반복되는 로직을 모듈화 및 재사용 가능하게 구성 |
| 테스트 가능성 확보 | 유닛/통합 테스트 작성이 가능한 구조로 분할 |

---

## 📦 주요 리팩토링 대상 영역

### 🔧 1. Python API 함수

| 대상 파일 | 개선 항목 |
|------------|-----------|
| `search.py` | 크롤링/점수화/정규화 로직 분리 → `utils/search_utils.py`로 모듈화 |
| `analyze.py` | 템플릿 생성기 → `rag_engine.py`로 분리 |
| `sync.py` | Google Sheets 연결/인증 로직을 별도 `google_client.py`로 추출 |
| `notify.py` | Telegram 전송기 모듈화 + 예외 핸들러 분리 적용 |

### 🧠 2. RAG 시스템
- 템플릿 엔진 / 데이터 전처리 / 토큰 필터링을 각각 함수화
- RAG 관련 함수는 `rag_engine.py` 내 전담 관리
- 향후 GPT 통합 시에도 동일 인터페이스 유지 (`generate_analysis(data: dict)` 형태)

### 🧱 3. 프론트엔드 (Next.js)

| 컴포넌트 | 개선 방향 |
|-----------|------------|
| `KeywordTable` | 정렬 기능 / 색상 뱃지 분리 → `useKeywordScoreBadge()` 훅 생성 |
| `AnalysisCard` | RAG 결과 렌더링 / 복사 / 접기 기능을 각각 하위 컴포넌트 분리 |
| `ButtonGroup` | 저장/알림 버튼을 모듈화하고 `onClick` 이벤트만 상위에서 제어 |

---

## 🔁 코드 리팩토링 규칙

| 항목 | 기준 |
|------|------|
| 함수 길이 | 한 함수는 50줄 이하 유지 권장 |
| 변수명 | 의미 있는 한글/영문명 혼용 금지 → snake_case 통일 (Python) |
| 예외 처리 | 모든 외부 호출 시 `try/except` 블록 적용 + 상세 에러 메시지 작성 |
| 타입 명시 | Pydantic 모델 및 TypeScript에서 명시적으로 type 선언 적용 |

---

## 🔄 리팩토링 스케줄 (WBS 연동)

| 일정 | 내용 |
|-------|------|
| 5/1 | RAG 시스템 분리 및 템플릿 함수화 완료 |
| 5/2 | API 모듈 분리: search/analyze/sync/notify 각 유틸화 |
| 5/3 | 프론트 컴포넌트 단위 분할 및 Storybook 도입 (선택) |
| 5/4~5/5 | 통합 테스트 / Playwright 시나리오 리팩토링 적용 |

---

## 📎 참고 문서
- [RAG 문서] → 템플릿 기반 함수 분리 기준
- [WBS 일정표] → 리팩토링 할당 일정 연동
- [Cursor Rules] → 코드 리팩토링 시 강제 적용되는 개발 기준
- [테스트 전략] → 테스트 가능 구조로 변경된 함수 구조 활용

---